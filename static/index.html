<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IG 人格分析｜上傳截圖</title>
  <style>
    body { font-family: system-ui, -apple-system, "Noto Sans TC", sans-serif; margin:0; background:#0b0d12; color:#e9eef5;}
    .wrap { max-width:720px; margin:0 auto; padding:20px; }
    .card { background:#131722; border:1px solid #232a3a; border-radius:16px; padding:16px; box-shadow:0 8px 24px rgba(0,0,0,.35); }
    .row{ display:flex; gap:12px; flex-wrap:wrap;}
    .col{ flex:1 1 240px;}
    input, select, button{ width:100%; padding:12px; border-radius:12px; border:1px solid #2a3348; background:#0f1420; color:#e9eef5;}
    input::file-selector-button{ padding:8px 12px; border-radius:8px; border:1px solid #2a3348; background:#182033; color:#e9eef5; margin-right:10px;}
    button{ background:#5b8cff; border:none; font-weight:600; }
    button:disabled{ opacity:.5;}
    .hint{ color:#9fb0d1; font-size:13px; line-height:1.5;}
    .title{ font-size:20px; font-weight:700; margin:8px 0 12px;}
    .result{ white-space:pre-wrap; background:#0f1420; border:1px dashed #2a3348; padding:12px; border-radius:12px; margin-top:12px;}
  </style>
</head>
<body>
  <div class="wrap">
    <h1 style="font-size:26px; margin:12px 0">上傳 IG 個人頁截圖</h1>
    <div class="card">
      <div class="title">必要素材</div>
      <div class="row">
        <div class="col">
          <label>IG 個人頁截圖（必填）</label>
          <input type="file" id="igShot" accept="image/*" required />
          <div class="hint">需看得到 username、名稱、bio、粉絲/追蹤/貼文數（盡量完整）</div>
        </div>
      </div>
      <div class="title" style="margin-top:16px;">可選素材（越多越準）</div>
      <div class="row">
        <div class="col">
          <label>九宮格首圖（最多 9 張）</label>
          <input type="file" id="grid" accept="image/*" multiple />
          <div class="hint">挑你最近最能代表風格的貼文首圖 3–9 張</div>
        </div>
      </div>
      <div class="title" style="margin-top:16px;">基本資料（非必填）</div>
      <div class="row">
        <div class="col">
          <input type="text" id="nickname" placeholder="暱稱（顯示在卡片上）"/>
        </div>
        <div class="col">
          <select id="gender">
            <option value="">性別（選填）</option>
            <option>女</option><option>男</option><option>非二元</option><option>不透露</option>
          </select>
        </div>
      </div>
      <button id="go" style="margin-top:16px;">開始分析</button>
      <div id="out" class="result" style="display:none;"></div>
    </div>
  </div>

  <script>
  const $ = (s)=>document.querySelector(s);
  const API = "https://socialavatar.onrender.com/api/analyze"; // 你的後端

  $("#go").addEventListener("click", async ()=>{
    const shot = $("#igShot").files[0];
    if(!shot){ alert("請上傳 IG 個人頁截圖"); return; }
    const fd = new FormData();
    fd.append("ig_screenshot", shot);
    const grids = $("#grid").files;
    [...grids].slice(0,9).forEach(f=> fd.append("grid[]", f));
    fd.append("nickname", $("#nickname").value || "");
    fd.append("gender", $("#gender").value || "");

    $("#go").disabled = true; $("#go").textContent = "分析中…";
    $("#out").style.display = "none";

    try{
      const r = await fetch(API, { method:"POST", body: fd });
      const j = await r.json();
      if(!j.ok){ throw new Error(j.error || "分析失敗"); }
      $("#out").style.display = "block";
      $("#out").textContent =
        `IG：${j.username || "-"}\n`+
        `名稱：${j.name || "-"}\n`+
        `粉絲/追蹤/貼文：${j.followers}/${j.following}/${j.posts}\n`+
        `MBTI：${j.mbti}\n`+
        `說明：${j.reason100}\n`+
        `載具：${j.tier}`;
    }catch(e){
      alert(e.message || "發生錯誤");
    }finally{
      $("#go").disabled = false; $("#go").textContent = "開始分析";
    }
  });
  </script>
</body>
</html>
