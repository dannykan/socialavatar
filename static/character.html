<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>è§’è‰²è£å‚™ï½œSocial Avatar</title>
  <link rel="stylesheet" href="/static/app.css">
  <style>
    body {
      background: linear-gradient(135deg, #1a0b2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
      color: #ffffff;
      font-family: 'Arial', sans-serif;
    }
    
    .header {
      padding: 15px 20px;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      border-bottom: 2px solid #4a90e2;
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .title {
      font-size: 24px;
      font-weight: bold;
      color: #4a90e2;
      text-shadow: 0 0 10px rgba(74, 144, 226, 0.5);
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    .currency {
      display: flex;
      align-items: center;
      gap: 5px;
      background: rgba(255, 255, 255, 0.1);
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 14px;
    }
    
    .currency-icon {
      width: 20px;
      height: 20px;
    }
    
    .main-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      display: grid;
      grid-template-columns: 1fr 2fr 1fr;
      gap: 20px;
      min-height: calc(100vh - 80px);
    }
    
    .left-panel {
      background: rgba(0, 0, 0, 0.6);
      border-radius: 15px;
      padding: 20px;
      border: 1px solid rgba(74, 144, 226, 0.3);
    }
    
    .center-panel {
      background: rgba(0, 0, 0, 0.4);
      border-radius: 15px;
      padding: 20px;
      border: 2px solid rgba(74, 144, 226, 0.5);
      position: relative;
      overflow: hidden;
    }
    
    .right-panel {
      background: rgba(0, 0, 0, 0.6);
      border-radius: 15px;
      padding: 20px;
      border: 1px solid rgba(74, 144, 226, 0.3);
    }
    
    .character-display {
      text-align: center;
      position: relative;
      height: 400px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    
    .character-video {
      max-width: 100%;
      max-height: 350px;
      border-radius: 10px;
      box-shadow: 0 0 30px rgba(74, 144, 226, 0.3);
    }
    
    .character-name {
      font-size: 20px;
      font-weight: bold;
      margin: 10px 0;
      color: #4a90e2;
      text-shadow: 0 0 10px rgba(74, 144, 226, 0.5);
    }
    
    .power-level {
      background: linear-gradient(45deg, #ff6b6b, #ffd93d);
      padding: 5px 15px;
      border-radius: 20px;
      font-weight: bold;
      color: #000;
      margin: 10px 0;
    }
    
    .vehicle-display {
      margin-top: 20px;
      text-align: center;
    }
    
    .vehicle-image {
      width: 80px;
      height: 80px;
      border-radius: 10px;
      margin: 10px auto;
      display: block;
      border: 2px solid #4a90e2;
    }
    
    .vehicle-name {
      font-size: 14px;
      color: #4a90e2;
      margin-top: 5px;
    }
    
    .equipment-section {
      margin-bottom: 20px;
    }
    
    .section-title {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 10px;
      color: #4a90e2;
      border-bottom: 1px solid rgba(74, 144, 226, 0.3);
      padding-bottom: 5px;
    }
    
    .equipment-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    
    .equipment-slot {
      background: rgba(255, 255, 255, 0.1);
      border: 2px dashed rgba(74, 144, 226, 0.5);
      border-radius: 10px;
      padding: 15px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .equipment-slot:hover {
      border-color: #4a90e2;
      background: rgba(74, 144, 226, 0.1);
    }
    
    .equipment-slot.equipped {
      border: 2px solid #4a90e2;
      background: rgba(74, 144, 226, 0.2);
    }
    
    .equipment-icon {
      width: 40px;
      height: 40px;
      margin: 0 auto 10px;
      background: rgba(74, 144, 226, 0.3);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }
    
    .equipment-name {
      font-size: 12px;
      color: #ffffff;
    }
    
    .inventory-section {
      margin-bottom: 20px;
    }
    
    .inventory-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }
    
    .inventory-item {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(74, 144, 226, 0.3);
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .inventory-item:hover {
      border-color: #4a90e2;
      background: rgba(74, 144, 226, 0.1);
    }
    
    .inventory-item.premium {
      border-color: #ffd700;
      background: rgba(255, 215, 0, 0.1);
    }
    
    .inventory-item.premium::after {
      content: 'ğŸ’';
      position: absolute;
      top: 5px;
      right: 5px;
      font-size: 12px;
    }
    
    .item-icon {
      width: 30px;
      height: 30px;
      margin: 0 auto 5px;
      background: rgba(74, 144, 226, 0.3);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }
    
    .item-name {
      font-size: 10px;
      color: #ffffff;
    }
    
    .item-price {
      font-size: 8px;
      color: #ffd700;
      margin-top: 2px;
    }
    
    .background-section {
      margin-bottom: 20px;
    }
    
    .background-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    
    .background-option {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(74, 144, 226, 0.3);
      border-radius: 10px;
      padding: 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .background-option:hover {
      border-color: #4a90e2;
    }
    
    .background-option.selected {
      border-color: #4a90e2;
      background: rgba(74, 144, 226, 0.2);
    }
    
    .background-option.premium {
      border-color: #ffd700;
    }
    
    .background-preview {
      width: 100%;
      height: 60px;
      border-radius: 5px;
      margin-bottom: 5px;
      background-size: cover;
      background-position: center;
    }
    
    .background-name {
      font-size: 12px;
      color: #ffffff;
    }
    
    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }
    
    .btn-primary {
      background: linear-gradient(45deg, #4a90e2, #357abd);
      color: white;
    }
    
    .btn-primary:hover {
      background: linear-gradient(45deg, #357abd, #2c5aa0);
      transform: translateY(-2px);
    }
    
    .btn-premium {
      background: linear-gradient(45deg, #ffd700, #ffed4e);
      color: #000;
    }
    
    .btn-premium:hover {
      background: linear-gradient(45deg, #ffed4e, #ffd700);
      transform: translateY(-2px);
    }
    
    .btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(74, 144, 226, 0.5);
    }
    
    .btn-secondary:hover {
      background: rgba(74, 144, 226, 0.2);
    }
    
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(74, 144, 226, 0.3);
      padding: 10px 0;
      z-index: 1000;
    }
    
    .nav-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-around;
      align-items: center;
    }
    
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      padding: 5px 10px;
      border-radius: 10px;
      transition: all 0.3s ease;
      color: #ffffff;
      text-decoration: none;
    }
    
    .nav-item:hover {
      background: rgba(74, 144, 226, 0.2);
    }
    
    .nav-item.active {
      background: rgba(74, 144, 226, 0.3);
      color: #4a90e2;
    }
    
    .nav-icon {
      font-size: 20px;
      margin-bottom: 2px;
    }
    
    .nav-label {
      font-size: 10px;
    }
    
    .notification {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #ff6b6b;
      color: white;
      padding: 2px 6px;
      border-radius: 10px;
      font-size: 10px;
      font-weight: bold;
    }
    
    @media (max-width: 768px) {
      .main-container {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .equipment-grid {
        grid-template-columns: repeat(3, 1fr);
      }
      
      .inventory-grid {
        grid-template-columns: repeat(4, 1fr);
      }
      
      .background-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-content">
      <div class="title">è§’è‰²è£å‚™</div>
      <div class="user-info">
        <div class="currency">
          <span class="currency-icon">ğŸ’</span>
          <span id="diamonds">0</span>
        </div>
        <div class="currency">
          <span class="currency-icon">â­</span>
          <span id="stars">951</span>
        </div>
        <div class="currency">
          <span class="currency-icon">ğŸ’°</span>
          <span id="coins">21.82è¬</span>
        </div>
        <button class="btn btn-secondary">å±¬æ€§è©³æƒ…</button>
      </div>
    </div>
  </header>

  <main class="main-container">
    <div class="left-panel">
      <div class="equipment-section">
        <div class="section-title">è£å‚™æ¬„</div>
        <div class="equipment-grid">
          <div class="equipment-slot" data-slot="weapon">
            <div class="equipment-icon">âš”ï¸</div>
            <div class="equipment-name">æ­¦å™¨</div>
          </div>
          <div class="equipment-slot" data-slot="armor">
            <div class="equipment-icon">ğŸ›¡ï¸</div>
            <div class="equipment-name">è­·ç”²</div>
          </div>
          <div class="equipment-slot" data-slot="accessory">
            <div class="equipment-icon">ğŸ’</div>
            <div class="equipment-name">é£¾å“</div>
          </div>
          <div class="equipment-slot" data-slot="special">
            <div class="equipment-icon">âœ¨</div>
            <div class="equipment-name">ç‰¹æ®Š</div>
          </div>
        </div>
      </div>
      
      <div class="inventory-section">
        <div class="section-title">é“å…·æ¬„</div>
        <div class="inventory-grid" id="inventoryGrid">
          <!-- é“å…·é …ç›®å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
        </div>
      </div>
    </div>

    <div class="center-panel">
      <div class="character-display">
        <video id="characterVideo" class="character-video" autoplay muted loop style="display: none;">
          <source src="" type="video/mp4">
        </video>
        <div id="characterPlaceholder" class="character-video" style="display: flex; align-items: center; justify-content: center; background: rgba(74, 144, 226, 0.1);">
          è¼‰å…¥è§’è‰²ä¸­...
        </div>
        <div class="character-name" id="characterName">æ˜Ÿå¡µæ³•å·«</div>
        <div class="power-level" id="powerLevel">æˆ°åŠ› 50000</div>
        
        <div class="vehicle-display">
          <img id="vehicleImage" class="vehicle-image" src="" alt="è¼‰å…·" style="display: none;">
          <div class="vehicle-name" id="vehicleName">åŸºç¤è¼‰å…·</div>
        </div>
      </div>
    </div>

    <div class="right-panel">
      <div class="background-section">
        <div class="section-title">èƒŒæ™¯é¢¨æ ¼</div>
        <div class="background-grid" id="backgroundGrid">
          <!-- èƒŒæ™¯é¸é …å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
        </div>
      </div>
      
      <div class="action-buttons">
        <button class="btn btn-primary" onclick="openInventory()">é“å…·ç®±</button>
        <button class="btn btn-premium" onclick="openShop()">å•†åº—</button>
        <button class="btn btn-secondary" onclick="goBackToResult()">è¿”å›çµæœ</button>
      </div>
    </div>
  </main>

  <nav class="bottom-nav">
    <div class="nav-content">
      <a href="#" class="nav-item">
        <div class="nav-icon">ğŸ‡</div>
        <div class="nav-label">åº§é¨</div>
      </a>
      <a href="#" class="nav-item">
        <div class="nav-icon">ğŸ§š</div>
        <div class="nav-label">ç²¾éˆ</div>
      </a>
      <a href="#" class="nav-item active">
        <div class="nav-icon">ğŸ‘¤</div>
        <div class="nav-label">äººç‰©</div>
      </a>
      <a href="#" class="nav-item">
        <div class="nav-icon">ğŸ’</div>
        <div class="nav-label">èƒŒåŒ…</div>
      </a>
      <a href="#" class="nav-item">
        <div class="nav-icon">ğŸ”¨</div>
        <div class="nav-label">é›é€ </div>
        <div class="notification">!</div>
      </a>
      <a href="#" class="nav-item">
        <div class="nav-icon">ğŸ“š</div>
        <div class="nav-label">ç§˜å¯¶</div>
      </a>
    </div>
  </nav>

  <script>
    // è§’è‰²æ•¸æ“š
    let characterData = {
      mbti: '',
      gender: '',
      username: '',
      followers: 0,
      powerLevel: 0,
      equipment: {
        weapon: null,
        armor: null,
        accessory: null,
        special: null
      },
      inventory: [],
      background: 'default',
      currency: {
        diamonds: 0,
        stars: 951,
        coins: 218200
      }
    };

    // è¼‰å…·ç­‰ç´šå°æ‡‰
    const vehicleLevels = {
      0: { name: 'æ­¥è¡Œ', image: '/static/images/vehicles/walk.png', power: 0 },
      1000: { name: 'è‡ªè¡Œè»Š', image: '/static/images/vehicles/bicycle.png', power: 1000 },
      5000: { name: 'æ‘©æ‰˜è»Š', image: '/static/images/vehicles/motorcycle.png', power: 2000 },
      10000: { name: 'æ±½è»Š', image: '/static/images/vehicles/car.png', power: 5000 },
      50000: { name: 'è·‘è»Š', image: '/static/images/vehicles/sports_car.png', power: 10000 },
      100000: { name: 'ç›´å‡æ©Ÿ', image: '/static/images/vehicles/helicopter.png', power: 20000 },
      500000: { name: 'ç§äººé£›æ©Ÿ', image: '/static/images/vehicles/private_jet.png', power: 50000 },
      1000000: { name: 'å¤ªç©ºèˆ¹', image: '/static/images/vehicles/spaceship.png', power: 100000 }
    };

    // èƒŒæ™¯é¸é …
    const backgroundOptions = [
      { id: 'default', name: 'é»˜èª', preview: 'linear-gradient(135deg, #1a0b2e 0%, #16213e 50%, #0f3460 100%)', premium: false },
      { id: 'forest', name: 'æ£®æ—', preview: 'linear-gradient(135deg, #0d4f3c 0%, #1a5f4a 50%, #2d7a5f 100%)', premium: false },
      { id: 'ocean', name: 'æµ·æ´‹', preview: 'linear-gradient(135deg, #0c4a6e 0%, #1e5f8f 50%, #2d7aa0 100%)', premium: false },
      { id: 'space', name: 'å¤ªç©º', preview: 'linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%)', premium: true },
      { id: 'crystal', name: 'æ°´æ™¶', preview: 'linear-gradient(135deg, #4a148c 0%, #7b1fa2 50%, #ab47bc 100%)', premium: true },
      { id: 'golden', name: 'é»ƒé‡‘', preview: 'linear-gradient(135deg, #ff8f00 0%, #ffa000 50%, #ffb300 100%)', premium: true }
    ];

    // é“å…·æ•¸æ“š
    const itemDatabase = {
      weapons: [
        { id: 'sword_basic', name: 'åŸºç¤åŠ', icon: 'âš”ï¸', power: 100, premium: false, price: 0 },
        { id: 'sword_fire', name: 'ç«ç„°åŠ', icon: 'ğŸ”¥', power: 500, premium: true, price: 100 },
        { id: 'sword_ice', name: 'å†°éœœåŠ', icon: 'â„ï¸', power: 500, premium: true, price: 100 },
        { id: 'staff_lightning', name: 'é›·é›»æ³•æ–', icon: 'âš¡', power: 800, premium: true, price: 200 }
      ],
      armors: [
        { id: 'armor_basic', name: 'åŸºç¤è­·ç”²', icon: 'ğŸ›¡ï¸', power: 50, premium: false, price: 0 },
        { id: 'armor_plate', name: 'æ¿ç”²', icon: 'ğŸ›¡ï¸', power: 300, premium: true, price: 150 },
        { id: 'robe_magic', name: 'é­”æ³•è¢', icon: 'ğŸ§™', power: 400, premium: true, price: 200 }
      ],
      accessories: [
        { id: 'ring_power', name: 'åŠ›é‡æˆ’æŒ‡', icon: 'ğŸ’', power: 200, premium: true, price: 100 },
        { id: 'amulet_wisdom', name: 'æ™ºæ…§è­·ç¬¦', icon: 'ğŸ”®', power: 300, premium: true, price: 150 },
        { id: 'crown_royal', name: 'çš‡å®¶ç‹å† ', icon: 'ğŸ‘‘', power: 500, premium: true, price: 300 }
      ],
      specials: [
        { id: 'wings_angel', name: 'å¤©ä½¿ä¹‹ç¿¼', icon: 'ğŸ‘¼', power: 1000, premium: true, price: 500 },
        { id: 'halo_divine', name: 'ç¥è–å…‰ç’°', icon: 'ğŸ˜‡', power: 800, premium: true, price: 400 },
        { id: 'aura_dragon', name: 'é¾ä¹‹æ°£æ¯', icon: 'ğŸ‰', power: 1200, premium: true, price: 600 }
      ]
    };

    function loadCharacterData() {
      const saved = sessionStorage.getItem('sa_result');
      if (saved) {
        try {
          const data = JSON.parse(saved);
          if (data && data.ok === true) {
            characterData.mbti = data.mbti || '';
            characterData.gender = data.gender || '';
            characterData.username = data.username || '';
            characterData.followers = data.followers || 0;
            
            // è¨ˆç®—æˆ°åŠ›
            characterData.powerLevel = calculatePowerLevel();
            
            // è¼‰å…¥è§’è‰²è¦–é »
            loadCharacterVideo();
            
            // è¼‰å…¥è¼‰å…·
            loadVehicle();
            
            // æ›´æ–°UI
            updateUI();
            
            // åˆå§‹åŒ–é“å…·æ¬„
            initializeInventory();
            
            // åˆå§‹åŒ–èƒŒæ™¯é¸é …
            initializeBackgrounds();
          }
        } catch (e) {
          console.error('Failed to parse character data:', e);
        }
      }
    }

    function calculatePowerLevel() {
      let basePower = 1000; // åŸºç¤æˆ°åŠ›
      let followerPower = Math.floor(characterData.followers / 100); // æ¯100å€‹ç²‰çµ²+1æˆ°åŠ›
      let mbtiPower = getMBTIPower(characterData.mbti);
      let equipmentPower = getEquipmentPower();
      
      return basePower + followerPower + mbtiPower + equipmentPower;
    }

    function getMBTIPower(mbti) {
      const mbtiPowers = {
        'INTJ': 200, 'INTP': 180, 'ENTJ': 190, 'ENTP': 170,
        'INFJ': 160, 'INFP': 140, 'ENFJ': 150, 'ENFP': 130,
        'ISTJ': 120, 'ISFJ': 100, 'ESTJ': 110, 'ESFJ': 90,
        'ISTP': 80, 'ISFP': 60, 'ESTP': 70, 'ESFP': 50
      };
      return mbtiPowers[mbti] || 0;
    }

    function getEquipmentPower() {
      let total = 0;
      Object.values(characterData.equipment).forEach(item => {
        if (item) total += item.power;
      });
      return total;
    }

    function loadCharacterVideo() {
      const videoEl = document.getElementById('characterVideo');
      const placeholderEl = document.getElementById('characterPlaceholder');
      
      if (!characterData.mbti || !characterData.gender) {
        placeholderEl.textContent = 'ç„¡æ³•è¼‰å…¥è§’è‰²ï¼šç¼ºå°‘ MBTI æˆ–æ€§åˆ¥è³‡è¨Š';
        return;
      }

      const mbtiType = String(characterData.mbti).toUpperCase().trim();
      const videoPath = `/static/videos/mbti/${mbtiType}_${characterData.gender}.mp4`;
      
      videoEl.src = videoPath;
      
      videoEl.addEventListener('loadeddata', function() {
        videoEl.style.display = 'block';
        placeholderEl.style.display = 'none';
      });
      
      videoEl.addEventListener('error', function() {
        placeholderEl.textContent = `ç„¡æ³•è¼‰å…¥ ${mbtiType} è§’è‰²è¦–é »`;
        placeholderEl.style.color = '#ff6b6b';
      });
    }

    function loadVehicle() {
      const vehicleImage = document.getElementById('vehicleImage');
      const vehicleName = document.getElementById('vehicleName');
      
      // æ ¹æ“šç²‰çµ²æ•¸é¸æ“‡è¼‰å…·
      let selectedVehicle = vehicleLevels[0];
      for (let threshold in vehicleLevels) {
        if (characterData.followers >= parseInt(threshold)) {
          selectedVehicle = vehicleLevels[threshold];
        }
      }
      
      vehicleImage.src = selectedVehicle.image;
      vehicleImage.style.display = 'block';
      vehicleName.textContent = selectedVehicle.name;
    }

    function updateUI() {
      document.getElementById('characterName').textContent = characterData.username ? `@${characterData.username}` : 'åŒ¿åç”¨æˆ¶';
      document.getElementById('powerLevel').textContent = `æˆ°åŠ› ${characterData.powerLevel.toLocaleString()}`;
      document.getElementById('diamonds').textContent = characterData.currency.diamonds;
      document.getElementById('stars').textContent = characterData.currency.stars;
      document.getElementById('coins').textContent = (characterData.currency.coins / 10000).toFixed(2) + 'è¬';
    }

    function initializeInventory() {
      const inventoryGrid = document.getElementById('inventoryGrid');
      inventoryGrid.innerHTML = '';
      
      // æ·»åŠ åŸºç¤é“å…·
      const basicItems = [
        ...itemDatabase.weapons.filter(item => !item.premium),
        ...itemDatabase.armors.filter(item => !item.premium)
      ];
      
      basicItems.forEach(item => {
        const itemEl = createInventoryItem(item);
        inventoryGrid.appendChild(itemEl);
      });
    }

    function createInventoryItem(item) {
      const itemEl = document.createElement('div');
      itemEl.className = `inventory-item ${item.premium ? 'premium' : ''}`;
      itemEl.innerHTML = `
        <div class="item-icon">${item.icon}</div>
        <div class="item-name">${item.name}</div>
        ${item.premium ? `<div class="item-price">${item.price}ğŸ’</div>` : ''}
      `;
      
      itemEl.addEventListener('click', () => equipItem(item));
      return itemEl;
    }

    function initializeBackgrounds() {
      const backgroundGrid = document.getElementById('backgroundGrid');
      backgroundGrid.innerHTML = '';
      
      backgroundOptions.forEach(bg => {
        const bgEl = document.createElement('div');
        bgEl.className = `background-option ${bg.premium ? 'premium' : ''} ${bg.id === characterData.background ? 'selected' : ''}`;
        bgEl.innerHTML = `
          <div class="background-preview" style="background: ${bg.preview}"></div>
          <div class="background-name">${bg.name}</div>
        `;
        
        bgEl.addEventListener('click', () => selectBackground(bg));
        backgroundGrid.appendChild(bgEl);
      });
    }

    function equipItem(item) {
      // æ ¹æ“šé“å…·é¡å‹è£å‚™åˆ°å°æ‡‰æ¬„ä½
      const slotType = getSlotType(item);
      if (slotType) {
        characterData.equipment[slotType] = item;
        updateEquipmentDisplay();
        updateUI();
      }
    }

    function getSlotType(item) {
      if (itemDatabase.weapons.includes(item)) return 'weapon';
      if (itemDatabase.armors.includes(item)) return 'armor';
      if (itemDatabase.accessories.includes(item)) return 'accessory';
      if (itemDatabase.specials.includes(item)) return 'special';
      return null;
    }

    function updateEquipmentDisplay() {
      Object.keys(characterData.equipment).forEach(slot => {
        const slotEl = document.querySelector(`[data-slot="${slot}"]`);
        const item = characterData.equipment[slot];
        
        if (item) {
          slotEl.classList.add('equipped');
          slotEl.querySelector('.equipment-icon').textContent = item.icon;
          slotEl.querySelector('.equipment-name').textContent = item.name;
        } else {
          slotEl.classList.remove('equipped');
        }
      });
    }

    function selectBackground(bg) {
      characterData.background = bg.id;
      document.body.style.background = bg.preview;
      
      // æ›´æ–°é¸ä¸­ç‹€æ…‹
      document.querySelectorAll('.background-option').forEach(el => el.classList.remove('selected'));
      event.target.closest('.background-option').classList.add('selected');
    }

    function openInventory() {
      alert('é“å…·ç®±åŠŸèƒ½é–‹ç™¼ä¸­...');
    }

    function openShop() {
      alert('å•†åº—åŠŸèƒ½é–‹ç™¼ä¸­...');
    }

    function goBackToResult() {
      window.location.href = '/static/result.html';
    }

    // åˆå§‹åŒ–
    window.addEventListener('DOMContentLoaded', loadCharacterData);
  </script>
</body>
</html>
