<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ËßíËâ≤Ë£ùÂÇôÔΩúSocial Avatar</title>
  <link rel="stylesheet" href="/static/app.css">
  <style>
    body {
      background: linear-gradient(135deg, #1a0b2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
      color: #ffffff;
      font-family: 'Arial', sans-serif;
    }
    
    .header {
      padding: 15px 20px;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      border-bottom: 2px solid #4a90e2;
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .title {
      font-size: 24px;
      font-weight: bold;
      color: #4a90e2;
      text-shadow: 0 0 10px rgba(74, 144, 226, 0.5);
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    
    .currency {
      display: flex;
      align-items: center;
      gap: 5px;
      background: rgba(255, 255, 255, 0.1);
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 14px;
    }
    
    .currency-icon {
      width: 20px;
      height: 20px;
    }
    
    .main-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      display: grid;
      grid-template-columns: 1fr 2fr 1fr;
      gap: 20px;
      min-height: calc(100vh - 80px);
    }
    
    .left-panel {
      background: rgba(0, 0, 0, 0.6);
      border-radius: 15px;
      padding: 20px;
      border: 1px solid rgba(74, 144, 226, 0.3);
    }
    
    .center-panel {
      background: rgba(0, 0, 0, 0.4);
      border-radius: 15px;
      padding: 20px;
      border: 2px solid rgba(74, 144, 226, 0.5);
      position: relative;
      overflow: hidden;
    }
    
    .right-panel {
      background: rgba(0, 0, 0, 0.6);
      border-radius: 15px;
      padding: 20px;
      border: 1px solid rgba(74, 144, 226, 0.3);
    }
    
    .character-display {
      text-align: center;
      position: relative;
      height: 400px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    
    .character-video {
      max-width: 100%;
      max-height: 350px;
      border-radius: 10px;
      box-shadow: 0 0 30px rgba(74, 144, 226, 0.3);
    }
    
    .character-name {
      font-size: 20px;
      font-weight: bold;
      margin: 10px 0;
      color: #4a90e2;
      text-shadow: 0 0 10px rgba(74, 144, 226, 0.5);
    }
    
    .power-level {
      background: linear-gradient(45deg, #ff6b6b, #ffd93d);
      padding: 5px 15px;
      border-radius: 20px;
      font-weight: bold;
      color: #000;
      margin: 10px 0;
    }
    
    .vehicle-display {
      margin-top: 20px;
      text-align: center;
    }
    
    .vehicle-image {
      width: 80px;
      height: 80px;
      border-radius: 10px;
      margin: 10px auto;
      display: block;
      border: 2px solid #4a90e2;
    }
    
    .vehicle-name {
      font-size: 14px;
      color: #4a90e2;
      margin-top: 5px;
    }
    
    .equipment-section {
      margin-bottom: 20px;
    }
    
    .section-title {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 10px;
      color: #4a90e2;
      border-bottom: 1px solid rgba(74, 144, 226, 0.3);
      padding-bottom: 5px;
    }
    
    .equipment-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    
    .equipment-slot {
      background: rgba(255, 255, 255, 0.1);
      border: 2px dashed rgba(74, 144, 226, 0.5);
      border-radius: 10px;
      padding: 15px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .equipment-slot:hover {
      border-color: #4a90e2;
      background: rgba(74, 144, 226, 0.1);
    }
    
    .equipment-slot.equipped {
      border: 2px solid #4a90e2;
      background: rgba(74, 144, 226, 0.2);
    }
    
    .equipment-icon {
      width: 40px;
      height: 40px;
      margin: 0 auto 10px;
      background: rgba(74, 144, 226, 0.3);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }
    
    .equipment-name {
      font-size: 12px;
      color: #ffffff;
    }
    
    .inventory-section {
      margin-bottom: 20px;
    }
    
    .inventory-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }
    
    .inventory-item {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(74, 144, 226, 0.3);
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .inventory-item:hover {
      border-color: #4a90e2;
      background: rgba(74, 144, 226, 0.1);
    }
    
    .inventory-item.premium {
      border-color: #ffd700;
      background: rgba(255, 215, 0, 0.1);
    }
    
    .inventory-item.premium::after {
      content: 'üíé';
      position: absolute;
      top: 5px;
      right: 5px;
      font-size: 12px;
    }
    
    .item-icon {
      width: 30px;
      height: 30px;
      margin: 0 auto 5px;
      background: rgba(74, 144, 226, 0.3);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }
    
    .item-name {
      font-size: 10px;
      color: #ffffff;
    }
    
    .item-price {
      font-size: 8px;
      color: #ffd700;
      margin-top: 2px;
    }
    
    .background-section {
      margin-bottom: 20px;
    }
    
    .background-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    
    .background-option {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(74, 144, 226, 0.3);
      border-radius: 10px;
      padding: 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .background-option:hover {
      border-color: #4a90e2;
    }
    
    .background-option.selected {
      border-color: #4a90e2;
      background: rgba(74, 144, 226, 0.2);
    }
    
    .background-option.premium {
      border-color: #ffd700;
    }
    
    .background-preview {
      width: 100%;
      height: 60px;
      border-radius: 5px;
      margin-bottom: 5px;
      background-size: cover;
      background-position: center;
    }
    
    .background-name {
      font-size: 12px;
      color: #ffffff;
    }
    
    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }
    
    .btn-primary {
      background: linear-gradient(45deg, #4a90e2, #357abd);
      color: white;
    }
    
    .btn-primary:hover {
      background: linear-gradient(45deg, #357abd, #2c5aa0);
      transform: translateY(-2px);
    }
    
    .btn-premium {
      background: linear-gradient(45deg, #ffd700, #ffed4e);
      color: #000;
    }
    
    .btn-premium:hover {
      background: linear-gradient(45deg, #ffed4e, #ffd700);
      transform: translateY(-2px);
    }
    
    .btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(74, 144, 226, 0.5);
    }
    
    .btn-secondary:hover {
      background: rgba(74, 144, 226, 0.2);
    }
    
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(10px);
      border-top: 1px solid rgba(74, 144, 226, 0.3);
      padding: 10px 0;
      z-index: 1000;
    }
    
    .nav-content {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      justify-content: space-around;
      align-items: center;
    }
    
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      padding: 5px 10px;
      border-radius: 10px;
      transition: all 0.3s ease;
      color: #ffffff;
      text-decoration: none;
    }
    
    .nav-item:hover {
      background: rgba(74, 144, 226, 0.2);
    }
    
    .nav-item.active {
      background: rgba(74, 144, 226, 0.3);
      color: #4a90e2;
    }
    
    .nav-icon {
      font-size: 20px;
      margin-bottom: 2px;
    }
    
    .nav-label {
      font-size: 10px;
    }
    
    .notification {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #ff6b6b;
      color: white;
      padding: 2px 6px;
      border-radius: 10px;
      font-size: 10px;
      font-weight: bold;
    }
    
    @media (max-width: 768px) {
      .main-container {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .equipment-grid {
        grid-template-columns: repeat(3, 1fr);
      }
      
      .inventory-grid {
        grid-template-columns: repeat(4, 1fr);
      }
      
      .background-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-content">
      <div class="title">ËßíËâ≤Ë£ùÂÇô</div>
      <div class="user-info">
        <div class="currency">
          <span class="currency-icon">üíé</span>
          <span id="diamonds">0</span>
        </div>
        <div class="currency">
          <span class="currency-icon">‚≠ê</span>
          <span id="stars">951</span>
        </div>
        <div class="currency">
          <span class="currency-icon">üí∞</span>
          <span id="coins">21.82Ëê¨</span>
        </div>
        <button class="btn btn-secondary">Â±¨ÊÄßË©≥ÊÉÖ</button>
      </div>
    </div>
  </header>

  <main class="main-container">
    <div class="left-panel">
      <div class="equipment-section">
        <div class="section-title">Ë£ùÂÇôÊ¨Ñ</div>
        <div class="equipment-grid">
          <div class="equipment-slot" data-slot="weapon">
            <div class="equipment-icon">‚öîÔ∏è</div>
            <div class="equipment-name">Ê≠¶Âô®</div>
          </div>
          <div class="equipment-slot" data-slot="armor">
            <div class="equipment-icon">üõ°Ô∏è</div>
            <div class="equipment-name">Ë≠∑Áî≤</div>
          </div>
          <div class="equipment-slot" data-slot="accessory">
            <div class="equipment-icon">üíç</div>
            <div class="equipment-name">È£æÂìÅ</div>
          </div>
          <div class="equipment-slot" data-slot="special">
            <div class="equipment-icon">‚ú®</div>
            <div class="equipment-name">ÁâπÊÆä</div>
          </div>
        </div>
      </div>
      
      <div class="inventory-section">
        <div class="section-title">ÈÅìÂÖ∑Ê¨Ñ</div>
        <div class="inventory-grid" id="inventoryGrid">
          <!-- ÈÅìÂÖ∑È†ÖÁõÆÂ∞áÁî±JavaScriptÂãïÊÖãÁîüÊàê -->
        </div>
      </div>
    </div>

    <div class="center-panel">
      <div class="character-display">
        <video id="characterVideo" class="character-video" autoplay muted loop style="display: none;">
          <source src="" type="video/mp4">
        </video>
        <div id="characterPlaceholder" class="character-video" style="display: flex; align-items: center; justify-content: center; background: rgba(74, 144, 226, 0.1);">
          ËºâÂÖ•ËßíËâ≤‰∏≠...
        </div>
        <div class="character-name" id="characterName">ÊòüÂ°µÊ≥ïÂ∑´</div>
        <div class="power-level" id="powerLevel">Êà∞Âäõ 50000</div>
        
        <div class="vehicle-display">
          <img id="vehicleImage" class="vehicle-image" src="" alt="ËºâÂÖ∑" style="display: none;">
          <div class="vehicle-name" id="vehicleName">Âü∫Á§éËºâÂÖ∑</div>
        </div>
      </div>
    </div>

    <div class="right-panel">
      <div class="background-section">
        <div class="section-title">ËÉåÊôØÈ¢®Ê†º</div>
        <div class="background-grid" id="backgroundGrid">
          <!-- ËÉåÊôØÈÅ∏È†ÖÂ∞áÁî±JavaScriptÂãïÊÖãÁîüÊàê -->
        </div>
      </div>
      
      <div class="action-buttons">
        <button class="btn btn-primary" onclick="openInventory()">ÈÅìÂÖ∑ÁÆ±</button>
        <button class="btn btn-premium" onclick="openShop()">ÂïÜÂ∫ó</button>
        <button class="btn btn-secondary" onclick="goBackToResult()">ËøîÂõûÁµêÊûú</button>
      </div>
    </div>
  </main>

  <nav class="bottom-nav">
    <div class="nav-content">
      <a href="#" class="nav-item">
        <div class="nav-icon">üèá</div>
        <div class="nav-label">Â∫ßÈ®é</div>
      </a>
      <a href="#" class="nav-item">
        <div class="nav-icon">üßö</div>
        <div class="nav-label">Á≤æÈùà</div>
      </a>
      <a href="#" class="nav-item active">
        <div class="nav-icon">üë§</div>
        <div class="nav-label">‰∫∫Áâ©</div>
      </a>
      <a href="#" class="nav-item">
        <div class="nav-icon">üéí</div>
        <div class="nav-label">ËÉåÂåÖ</div>
      </a>
      <a href="#" class="nav-item">
        <div class="nav-icon">üî®</div>
        <div class="nav-label">ÈçõÈÄ†</div>
        <div class="notification">!</div>
      </a>
      <a href="#" class="nav-item">
        <div class="nav-icon">üìö</div>
        <div class="nav-label">ÁßòÂØ∂</div>
      </a>
    </div>
  </nav>

  <script>
    // ËßíËâ≤Êï∏Êìö
    let characterData = {
      mbti: '',
      gender: '',
      username: '',
      followers: 0,
      powerLevel: 0,
      equipment: {
        weapon: null,
        armor: null,
        accessory: null,
        special: null
      },
      inventory: [],
      background: 'default',
      currency: {
        diamonds: 0,
        stars: 951,
        coins: 218200
      }
    };

    // ËºâÂÖ∑Á≠âÁ¥öÂ∞çÊáâ
    const vehicleLevels = {
      0: { name: 'Ê≠•Ë°å', image: '/static/images/vehicles/walk.png', power: 0 },
      1000: { name: 'Ëá™Ë°åËªä', image: '/static/images/vehicles/bicycle.png', power: 1000 },
      5000: { name: 'Êë©ÊâòËªä', image: '/static/images/vehicles/motorcycle.png', power: 2000 },
      10000: { name: 'Ê±ΩËªä', image: '/static/images/vehicles/car.png', power: 5000 },
      50000: { name: 'Ë∑ëËªä', image: '/static/images/vehicles/sports_car.png', power: 10000 },
      100000: { name: 'Áõ¥ÂçáÊ©ü', image: '/static/images/vehicles/helicopter.png', power: 20000 },
      500000: { name: 'ÁßÅ‰∫∫È£õÊ©ü', image: '/static/images/vehicles/private_jet.png', power: 50000 },
      1000000: { name: 'Â§™Á©∫Ëàπ', image: '/static/images/vehicles/spaceship.png', power: 100000 }
    };

    // ËÉåÊôØÈÅ∏È†Ö
    const backgroundOptions = [
      { id: 'default', name: 'ÈªòË™ç', preview: 'linear-gradient(135deg, #1a0b2e 0%, #16213e 50%, #0f3460 100%)', premium: false },
      { id: 'forest', name: 'Ê£ÆÊûó', preview: 'linear-gradient(135deg, #0d4f3c 0%, #1a5f4a 50%, #2d7a5f 100%)', premium: false },
      { id: 'ocean', name: 'Êµ∑Ê¥ã', preview: 'linear-gradient(135deg, #0c4a6e 0%, #1e5f8f 50%, #2d7aa0 100%)', premium: false },
      { id: 'space', name: 'Â§™Á©∫', preview: 'linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%)', premium: true },
      { id: 'crystal', name: 'Ê∞¥Êô∂', preview: 'linear-gradient(135deg, #4a148c 0%, #7b1fa2 50%, #ab47bc 100%)', premium: true },
      { id: 'golden', name: 'ÈªÉÈáë', preview: 'linear-gradient(135deg, #ff8f00 0%, #ffa000 50%, #ffb300 100%)', premium: true }
    ];

    // ÈÅìÂÖ∑Êï∏Êìö
    const itemDatabase = {
      weapons: [
        { id: 'sword_basic', name: 'Âü∫Á§éÂäç', icon: '‚öîÔ∏è', power: 100, premium: false, price: 0 },
        { id: 'sword_fire', name: 'ÁÅ´ÁÑ∞Âäç', icon: 'üî•', power: 500, premium: true, price: 100 },
        { id: 'sword_ice', name: 'ÂÜ∞ÈúúÂäç', icon: '‚ùÑÔ∏è', power: 500, premium: true, price: 100 },
        { id: 'staff_lightning', name: 'Èõ∑ÈõªÊ≥ïÊùñ', icon: '‚ö°', power: 800, premium: true, price: 200 }
      ],
      armors: [
        { id: 'armor_basic', name: 'Âü∫Á§éË≠∑Áî≤', icon: 'üõ°Ô∏è', power: 50, premium: false, price: 0 },
        { id: 'armor_plate', name: 'ÊùøÁî≤', icon: 'üõ°Ô∏è', power: 300, premium: true, price: 150 },
        { id: 'robe_magic', name: 'È≠îÊ≥ïË¢ç', icon: 'üßô', power: 400, premium: true, price: 200 }
      ],
      accessories: [
        { id: 'ring_power', name: 'ÂäõÈáèÊàíÊåá', icon: 'üíç', power: 200, premium: true, price: 100 },
        { id: 'amulet_wisdom', name: 'Êô∫ÊÖßË≠∑Á¨¶', icon: 'üîÆ', power: 300, premium: true, price: 150 },
        { id: 'crown_royal', name: 'ÁöáÂÆ∂ÁéãÂÜ†', icon: 'üëë', power: 500, premium: true, price: 300 }
      ],
      specials: [
        { id: 'wings_angel', name: 'Â§©‰Ωø‰πãÁøº', icon: 'üëº', power: 1000, premium: true, price: 500 },
        { id: 'halo_divine', name: 'Á•ûËÅñÂÖâÁí∞', icon: 'üòá', power: 800, premium: true, price: 400 },
        { id: 'aura_dragon', name: 'Èæç‰πãÊ∞£ÊÅØ', icon: 'üêâ', power: 1200, premium: true, price: 600 }
      ]
    };

    function loadCharacterData() {
      const saved = sessionStorage.getItem('sa_result');
      if (saved) {
        try {
          const data = JSON.parse(saved);
          if (data && data.ok === true) {
            characterData.mbti = data.mbti || '';
            characterData.gender = data.gender || '';
            characterData.username = data.username || '';
            characterData.followers = data.followers || 0;
            
            // Ë®àÁÆóÊà∞Âäõ
            characterData.powerLevel = calculatePowerLevel();
            
            // ËºâÂÖ•ËßíËâ≤Ë¶ñÈ†ª
            loadCharacterVideo();
            
            // ËºâÂÖ•ËºâÂÖ∑
            loadVehicle();
            
            // Êõ¥Êñ∞UI
            updateUI();
            
            // ÂàùÂßãÂåñÈÅìÂÖ∑Ê¨Ñ
            initializeInventory();
            
            // ÂàùÂßãÂåñËÉåÊôØÈÅ∏È†Ö
            initializeBackgrounds();
          }
        } catch (e) {
          console.error('Failed to parse character data:', e);
        }
      }
    }

    function calculatePowerLevel() {
      let basePower = 1000; // Âü∫Á§éÊà∞Âäõ
      let followerPower = Math.floor(characterData.followers / 100); // ÊØè100ÂÄãÁ≤âÁµ≤+1Êà∞Âäõ
      let mbtiPower = getMBTIPower(characterData.mbti);
      let equipmentPower = getEquipmentPower();
      
      return basePower + followerPower + mbtiPower + equipmentPower;
    }

    function getMBTIPower(mbti) {
      const mbtiPowers = {
        'INTJ': 200, 'INTP': 180, 'ENTJ': 190, 'ENTP': 170,
        'INFJ': 160, 'INFP': 140, 'ENFJ': 150, 'ENFP': 130,
        'ISTJ': 120, 'ISFJ': 100, 'ESTJ': 110, 'ESFJ': 90,
        'ISTP': 80, 'ISFP': 60, 'ESTP': 70, 'ESFP': 50
      };
      return mbtiPowers[mbti] || 0;
    }

    function getEquipmentPower() {
      let total = 0;
      Object.values(characterData.equipment).forEach(item => {
        if (item) total += item.power;
      });
      return total;
    }

    function loadCharacterVideo() {
      const videoEl = document.getElementById('characterVideo');
      const placeholderEl = document.getElementById('characterPlaceholder');
      
      if (!characterData.mbti || !characterData.gender) {
        placeholderEl.textContent = 'ÁÑ°Ê≥ïËºâÂÖ•ËßíËâ≤ÔºöÁº∫Â∞ë MBTI ÊàñÊÄßÂà•Ë≥áË®ä';
        return;
      }

      const mbtiType = String(characterData.mbti).toUpperCase().trim();
      const videoPath = `/static/videos/mbti/${mbtiType}_${characterData.gender}.mp4`;
      
      videoEl.src = videoPath;
      
      videoEl.addEventListener('loadeddata', function() {
        videoEl.style.display = 'block';
        placeholderEl.style.display = 'none';
      });
      
      videoEl.addEventListener('error', function() {
        placeholderEl.textContent = `ÁÑ°Ê≥ïËºâÂÖ• ${mbtiType} ËßíËâ≤Ë¶ñÈ†ª`;
        placeholderEl.style.color = '#ff6b6b';
      });
    }

    function loadVehicle() {
      const vehicleImage = document.getElementById('vehicleImage');
      const vehicleName = document.getElementById('vehicleName');
      
      // Ê†πÊìöÁ≤âÁµ≤Êï∏ÈÅ∏ÊìáËºâÂÖ∑
      let selectedVehicle = vehicleLevels[0];
      for (let threshold in vehicleLevels) {
        if (characterData.followers >= parseInt(threshold)) {
          selectedVehicle = vehicleLevels[threshold];
        }
      }
      
      vehicleImage.src = selectedVehicle.image;
      vehicleImage.style.display = 'block';
      vehicleName.textContent = selectedVehicle.name;
    }

    function updateUI() {
      document.getElementById('characterName').textContent = characterData.username ? `@${characterData.username}` : 'ÂåøÂêçÁî®Êà∂';
      document.getElementById('powerLevel').textContent = `Êà∞Âäõ ${characterData.powerLevel.toLocaleString()}`;
      document.getElementById('diamonds').textContent = characterData.currency.diamonds;
      document.getElementById('stars').textContent = characterData.currency.stars;
      document.getElementById('coins').textContent = (characterData.currency.coins / 10000).toFixed(2) + 'Ëê¨';
    }

    function initializeInventory() {
      const inventoryGrid = document.getElementById('inventoryGrid');
      inventoryGrid.innerHTML = '';
      
      // Ê∑ªÂä†Âü∫Á§éÈÅìÂÖ∑
      const basicItems = [
        ...itemDatabase.weapons.filter(item => !item.premium),
        ...itemDatabase.armors.filter(item => !item.premium)
      ];
      
      basicItems.forEach(item => {
        const itemEl = createInventoryItem(item);
        inventoryGrid.appendChild(itemEl);
      });
    }

    function createInventoryItem(item) {
      const itemEl = document.createElement('div');
      itemEl.className = `inventory-item ${item.premium ? 'premium' : ''}`;
      itemEl.innerHTML = `
        <div class="item-icon">${item.icon}</div>
        <div class="item-name">${item.name}</div>
        ${item.premium ? `<div class="item-price">${item.price}üíé</div>` : ''}
      `;
      
      itemEl.addEventListener('click', () => equipItem(item));
      return itemEl;
    }

    function initializeBackgrounds() {
      const backgroundGrid = document.getElementById('backgroundGrid');
      backgroundGrid.innerHTML = '';
      
      backgroundOptions.forEach(bg => {
        const bgEl = document.createElement('div');
        bgEl.className = `background-option ${bg.premium ? 'premium' : ''} ${bg.id === characterData.background ? 'selected' : ''}`;
        bgEl.innerHTML = `
          <div class="background-preview" style="background: ${bg.preview}"></div>
          <div class="background-name">${bg.name}</div>
        `;
        
        bgEl.addEventListener('click', () => selectBackground(bg));
        backgroundGrid.appendChild(bgEl);
      });
    }

    function equipItem(item) {
      // Ê†πÊìöÈÅìÂÖ∑È°ûÂûãË£ùÂÇôÂà∞Â∞çÊáâÊ¨Ñ‰Ωç
      const slotType = getSlotType(item);
      if (slotType) {
        characterData.equipment[slotType] = item;
        updateEquipmentDisplay();
        updateUI();
      }
    }

    function getSlotType(item) {
      if (itemDatabase.weapons.includes(item)) return 'weapon';
      if (itemDatabase.armors.includes(item)) return 'armor';
      if (itemDatabase.accessories.includes(item)) return 'accessory';
      if (itemDatabase.specials.includes(item)) return 'special';
      return null;
    }

    function updateEquipmentDisplay() {
      Object.keys(characterData.equipment).forEach(slot => {
        const slotEl = document.querySelector(`[data-slot="${slot}"]`);
        const item = characterData.equipment[slot];
        
        if (item) {
          slotEl.classList.add('equipped');
          slotEl.querySelector('.equipment-icon').textContent = item.icon;
          slotEl.querySelector('.equipment-name').textContent = item.name;
        } else {
          slotEl.classList.remove('equipped');
        }
      });
    }

    function selectBackground(bg) {
      characterData.background = bg.id;
      document.body.style.background = bg.preview;
      
      // Êõ¥Êñ∞ÈÅ∏‰∏≠ÁãÄÊÖã
      document.querySelectorAll('.background-option').forEach(el => el.classList.remove('selected'));
      event.target.closest('.background-option').classList.add('selected');
    }

    function openInventory() {
      alert('ÈÅìÂÖ∑ÁÆ±ÂäüËÉΩÈñãÁôº‰∏≠...');
    }

    function openShop() {
      alert('ÂïÜÂ∫óÂäüËÉΩÈñãÁôº‰∏≠...');
    }

    function goBackToResult() {
      window.location.href = '/static/result.html';
    }

    // ÂàùÂßãÂåñ
    window.addEventListener('DOMContentLoaded', loadCharacterData);
  </script>
</body>
</html>
