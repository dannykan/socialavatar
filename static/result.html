<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>‰Ω†ÁöÑ IG ‰∫∫Ê†ºÈ°ûÂûãÔΩúÂàÜÊûêÁµêÊûú</title>
  <link rel="stylesheet" href="/static/app.css">
  <style>
    body {
      background: radial-gradient(1000px 600px at -10% -10%, var(--primary-dark) 0, transparent 60%),
                  radial-gradient(1200px 600px at 110% 0%, var(--secondary) 0, transparent 60%),
                  var(--bg);
      min-height: 100vh;
    }
    
    .header {
      padding: var(--spacing) var(--spacing-md);
      border-bottom: 1px solid var(--border);
      background: rgba(11, 18, 32, 0.8);
      backdrop-filter: blur(8px);
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: var(--spacing-lg);
    }
    
    .result-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--spacing-lg);
    }
    
    .personality-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-xl);
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
    }
    
    .personality-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
    }
    
    .type-header {
      text-align: center;
      margin-bottom: var(--spacing-xl);
      padding-bottom: var(--spacing-lg);
      border-bottom: 1px solid var(--border);
    }
    
    .type-emoji {
      font-size: 72px;
      margin-bottom: var(--spacing);
      animation: float 3s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    
    .type-name-zh {
      font-size: var(--font-size-3xl);
      font-weight: 700;
      margin: 0 0 var(--spacing-sm);
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .type-name-en {
      font-size: var(--font-size-lg);
      color: var(--muted);
      margin: 0;
      font-style: italic;
    }
    
    .personality-statement-card {
      background: linear-gradient(135deg, rgba(34, 211, 238, 0.1), rgba(147, 51, 234, 0.1));
      border: 1px solid rgba(34, 211, 238, 0.3);
      border-radius: var(--radius-md);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-lg);
      position: relative;
    }
    
    .personality-statement-card::before {
      content: '"';
      position: absolute;
      top: 8px;
      left: 12px;
      font-size: 48px;
      color: var(--primary);
      opacity: 0.3;
      font-family: Georgia, serif;
    }
    
    .personality-statement-card p {
      margin: 0;
      font-size: var(--font-size-lg);
      line-height: 1.7;
      color: var(--text);
      font-style: italic;
      padding-left: var(--spacing-lg);
    }
    
    .analysis-section {
      margin-bottom: var(--spacing-lg);
    }
    
    .analysis-section h3 {
      font-size: var(--font-size-lg);
      font-weight: 600;
      margin: 0 0 var(--spacing);
      color: var(--text);
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }
    
    .analysis-section h3::before {
      content: '';
      width: 4px;
      height: 20px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border-radius: 2px;
    }
    
    .color-palette {
      display: flex;
      gap: var(--spacing);
      flex-wrap: wrap;
    }
    
    .color-block {
      width: 80px;
      height: 80px;
      border-radius: var(--radius-md);
      border: 2px solid var(--border-light);
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      box-shadow: var(--shadow);
    }
    
    .color-block:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }
    
    .color-block::after {
      content: attr(title);
      position: absolute;
      bottom: -28px;
      left: 50%;
      transform: translateX(-50%);
      font-size: var(--font-size-xs);
      color: var(--muted);
      white-space: nowrap;
    }
    
    .keyword-tags {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-sm);
    }
    
    .keyword-tag {
      display: inline-block;
      padding: var(--spacing-sm) var(--spacing);
      background: rgba(34, 211, 238, 0.1);
      border: 1px solid rgba(34, 211, 238, 0.3);
      border-radius: var(--radius-md);
      font-size: var(--font-size-sm);
      color: var(--primary);
      font-weight: 500;
      transition: var(--transition);
    }
    
    .keyword-tag:hover {
      background: rgba(34, 211, 238, 0.2);
      transform: translateY(-2px);
    }
    
    .style-description {
      background: var(--bg-secondary);
      padding: var(--spacing);
      border-radius: var(--radius-md);
      border-left: 3px solid var(--primary);
      margin-bottom: var(--spacing);
    }
    
    .style-description p {
      margin: 0;
      color: var(--text);
      line-height: 1.6;
    }
    
    .style-label {
      font-weight: 600;
      color: var(--primary);
      margin-right: var(--spacing-sm);
    }
    
    .confidence-bar {
      position: relative;
      width: 100%;
      height: 32px;
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
      overflow: hidden;
      border: 1px solid var(--border-light);
    }
    
    .confidence-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      transition: width 1s ease;
      border-radius: var(--radius-md);
    }
    
    .confidence-text {
      position: absolute;
      right: var(--spacing);
      top: 50%;
      transform: translateY(-50%);
      font-weight: 700;
      color: var(--text);
      font-size: var(--font-size-sm);
      z-index: 1;
    }
    
    .secondary-type {
      background: linear-gradient(135deg, rgba(147, 51, 234, 0.1), rgba(124, 58, 237, 0.1));
      border: 1px solid rgba(147, 51, 234, 0.3);
      border-radius: var(--radius-md);
      padding: var(--spacing);
      display: flex;
      align-items: center;
      gap: var(--spacing);
    }
    
    .secondary-emoji {
      font-size: 32px;
    }
    
    .secondary-name {
      flex: 1;
      font-size: var(--font-size-lg);
      font-weight: 600;
    }
    
    .secondary-confidence {
      font-size: var(--font-size-sm);
      color: var(--muted);
      padding: 4px 12px;
      background: rgba(147, 51, 234, 0.2);
      border-radius: var(--radius);
      font-weight: 600;
    }
    
    .user-info-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: var(--spacing-lg);
      box-shadow: var(--shadow-md);
    }
    
    .user-header {
      margin-bottom: var(--spacing);
      padding-bottom: var(--spacing);
      border-bottom: 1px solid var(--border);
    }
    
    .user-name {
      margin: 0 0 4px;
      font-size: var(--font-size-xl);
      font-weight: 700;
    }
    
    .user-handle {
      color: var(--muted);
      font-size: var(--font-size-sm);
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--spacing);
      margin-bottom: var(--spacing);
    }
    
    .stat-item {
      text-align: center;
      padding: var(--spacing);
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
    }
    
    .stat-value {
      display: block;
      font-size: var(--font-size-xl);
      font-weight: 700;
      margin-bottom: 4px;
    }
    
    .stat-label {
      font-size: var(--font-size-xs);
      color: var(--muted);
      text-transform: uppercase;
    }
    
    @media (max-width: 768px) {
      .personality-card {
        padding: var(--spacing-lg);
      }
      
      .type-emoji {
        font-size: 56px;
      }
      
      .color-block {
        width: 60px;
        height: 60px;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <div><strong>IG ‰∫∫Ê†ºÂàÜÊûê</strong></div>
    <button class="btn btn-ghost btn-sm" onclick="clearAndRestart(event)">Ê∏ÖÈô§Èáç‰æÜ</button>
  </header>

  <main class="container">
    <div id="err" class="status-error hidden"></div>
    
    <div class="result-grid">
      <div class="personality-card">
        <div class="type-header">
          <div class="type-emoji" id="typeEmoji">üé®</div>
          <h2 class="type-name-zh" id="typeNameZh">Ââµ‰ΩúËÄÖ</h2>
          <p class="type-name-en" id="typeNameEn">Creator</p>
        </div>
        
        <div class="personality-statement-card">
          <p id="personalityStatement">Ê≠£Âú®Êé¢Á¥¢Â±¨ÊñºËá™Â∑±ÁöÑÁç®ÁâπÈ¢®Ê†º...</p>
        </div>
        
        <section class="analysis-section">
          <h3>Ëâ≤ÂΩ©Âü∫Âõ†</h3>
          <div class="color-palette" id="colorPalette"></div>
        </section>
        
        <section class="analysis-section">
          <h3>È¢®Ê†ºÁâπÂæµ</h3>
          <div class="style-description">
            <p id="visualStyle"><span class="style-label">Ë¶ñË¶∫È¢®Ê†ºÔºö</span>ËºâÂÖ•‰∏≠...</p>
          </div>
          <div class="style-description">
            <p id="bioTone"><span class="style-label">Bio Ë™ûÊ∞£Ôºö</span>ËºâÂÖ•‰∏≠...</p>
          </div>
          <div class="style-description">
            <p id="contentTheme"><span class="style-label">ÂÖßÂÆπ‰∏ªÈ°åÔºö</span>ËºâÂÖ•‰∏≠...</p>
          </div>
        </section>
        
        <section class="analysis-section">
          <h3>È¢®Ê†ºÈóúÈçµË©û</h3>
          <div class="keyword-tags" id="keywordTags"></div>
        </section>
        
        <section class="analysis-section">
          <h3>È°ûÂûã‰ø°ÂøÉÂ∫¶</h3>
          <div class="confidence-bar">
            <div class="confidence-fill" id="confidenceFill" style="width:0%"></div>
            <span class="confidence-text" id="confidenceText">0%</span>
          </div>
        </section>
        
        <section class="analysis-section" id="secondarySection" style="display:none">
          <h3>Áõ∏‰ººÈ¢®Ê†º</h3>
          <div class="secondary-type" id="secondaryType"></div>
        </section>
      </div>
      
      <div class="user-info-card">
        <div class="user-header">
          <h3 class="user-name" id="display_name">‰ΩøÁî®ËÄÖ</h3>
          <p class="user-handle" id="username">@username</p>
        </div>
        
        <div class="stats-grid">
          <div class="stat-item">
            <span class="stat-value" id="followers">0</span>
            <span class="stat-label">Followers</span>
          </div>
          <div class="stat-item">
            <span class="stat-value" id="following">0</span>
            <span class="stat-label">Following</span>
          </div>
          <div class="stat-item">
            <span class="stat-value" id="posts">0</span>
            <span class="stat-label">Posts</span>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script>
    (function() {
      if (window.history && window.history.pushState) {
        window.history.pushState(null, null, window.location.href);
        window.addEventListener('popstate', function() {
          window.history.pushState(null, null, window.location.href);
          if (confirm('‚ö†Ô∏è ÁÑ°Ê≥ïËøîÂõû‰∏ä‰∏ÄÈ†Å\n\nËã•Ë¶ÅÈáçÊñ∞ÂàÜÊûêÔºåË´ãÈªûÊìä„ÄåÊ∏ÖÈô§Èáç‰æÜ„Äç„ÄÇ\n\nÊòØÂê¶ÁèæÂú®Ê∏ÖÈô§Ôºü')) {
            clearAndRestart();
          }
        });
      }
    })();

    function fillUI(data) {
      if (data.primary_type) {
        const p = data.primary_type;
        document.getElementById('typeEmoji').textContent = p.emoji || 'üé®';
        document.getElementById('typeNameZh').textContent = p.name_zh || 'Ââµ‰ΩúËÄÖ';
        document.getElementById('typeNameEn').textContent = p.name_en || 'Creator';
        
        const conf = Math.max(0, Math.min(100, Math.round((p.confidence || 0.5) * 100)));
        setTimeout(() => {
          document.getElementById('confidenceFill').style.width = conf + '%';
        }, 300);
        document.getElementById('confidenceText').textContent = conf + '%';
      }
      
      document.getElementById('personalityStatement').textContent = 
        data.personality_statement || 'Ê≠£Âú®Êé¢Á¥¢Â±¨ÊñºËá™Â∑±ÁöÑÁç®ÁâπÈ¢®Ê†º...';
      
      if (data.analysis) {
        const a = data.analysis;
        
        if (a.color_palette) {
          const palette = document.getElementById('colorPalette');
          palette.innerHTML = '';
          a.color_palette.forEach(c => {
            const block = document.createElement('div');
            block.className = 'color-block';
            block.style.background = c;
            block.title = c;
            palette.appendChild(block);
          });
        }
        
        if (a.visual_style) 
          document.getElementById('visualStyle').innerHTML = 
            `<span class="style-label">Ë¶ñË¶∫È¢®Ê†ºÔºö</span>${a.visual_style}`;
        if (a.bio_tone) 
          document.getElementById('bioTone').innerHTML = 
            `<span class="style-label">Bio Ë™ûÊ∞£Ôºö</span>${a.bio_tone}`;
        if (a.content_theme) 
          document.getElementById('contentTheme').innerHTML = 
            `<span class="style-label">ÂÖßÂÆπ‰∏ªÈ°åÔºö</span>${a.content_theme}`;
        
        if (a.unique_traits) {
          const tags = document.getElementById('keywordTags');
          tags.innerHTML = '';
          a.unique_traits.forEach(t => {
            const tag = document.createElement('span');
            tag.className = 'keyword-tag';
            tag.textContent = '#' + t;
            tags.appendChild(tag);
          });
        }
      }
      
      if (data.secondary_type) {
        document.getElementById('secondarySection').style.display = 'block';
        const s = data.secondary_type;
        document.getElementById('secondaryType').innerHTML = `
          <span class="secondary-emoji">${s.emoji}</span>
          <span class="secondary-name">${s.name_zh}</span>
          <span class="secondary-confidence">${Math.round((s.confidence||0)*100)}%</span>
        `;
      }
      
      document.getElementById('display_name').textContent = data.display_name || '‰ΩøÁî®ËÄÖ';
      document.getElementById('username').textContent = data.username ? '@'+data.username : '‚Äî';
      document.getElementById('followers').textContent = (data.followers||0).toLocaleString();
      document.getElementById('following').textContent = (data.following||0).toLocaleString();
      document.getElementById('posts').textContent = (data.posts||0).toLocaleString();
    }

    async function loadResult() {
      const saved = sessionStorage.getItem('sa_result');
      if (saved) {
        try {
          const data = JSON.parse(saved);
          if (data && data.ok) {
            fillUI(data);
            return;
          }
        } catch {}
      }
      
      try {
        const r = await fetch('/debug/last_ai?ts='+Date.now());
        if (r.ok) {
          const j = await r.json();
          let parsed = null;
          try {
            parsed = JSON.parse(j.text || j.raw || '{}');
          } catch {}
          if (parsed) {
            fillUI(parsed);
            return;
          }
        }
      } catch {}
      
      document.getElementById('err').textContent = 'Êâæ‰∏çÂà∞ÂàÜÊûêÁµêÊûúÔºå3ÁßíÂæåËøîÂõûÈ¶ñÈ†Å';
      document.getElementById('err').style.display = 'block';
      setTimeout(() => location.href = '/static/upload.html', 3000);
    }

    async function clearAndRestart(evt) {
      if (evt && !confirm('Á¢∫ÂÆöË¶ÅÊ∏ÖÈô§ÊâÄÊúâË≥áÊñôÔºü\n\nÈÄôÂ∞áÂà™Èô§ÂàÜÊûêÁµêÊûú‰∏¶ÁôªÂá∫„ÄÇ')) return;
      
      try {
        const [{ initializeApp, getApps }, { getAuth, signOut }, { getFirestore, doc, deleteDoc }] = 
          await Promise.all([
            import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js'),
            import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js'),
            import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js')
          ]);

        const config = {
          apiKey: "AIzaSyBI2-4yEwzxvYOvui9FZiGAzCE22OhKmU8",
          authDomain: "social-avatar-d13c8.firebaseapp.com",
          projectId: "social-avatar-d13c8",
          storageBucket: "social-avatar-d13c8.appspot.com",
          messagingSenderId: "280598358339",
          appId: "1:280598358339:web:214a0d4ca53793163367f6"
        };

        const app = getApps().length ? getApps()[0] : initializeApp(config);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        const user = auth.currentUser;
        if (user) {
          await deleteDoc(doc(db, 'users', user.uid)).catch(()=>{});
        }
        
        sessionStorage.clear();
        localStorage.clear();
        await signOut(auth).catch(()=>{});
        
        alert('‚úÖ Â∑≤Ê∏ÖÈô§ÊâÄÊúâË≥áÊñô\n\nË´ãÈáçÊñ∞ÁôªÂÖ•');
        location.replace('/static/landing.html');
      } catch (e) {
        alert('Ê∏ÖÈô§Â§±ÊïóÔºö' + e.message);
      }
    }

    window.addEventListener('DOMContentLoaded', loadResult);
  </script>
</body>
</html>
