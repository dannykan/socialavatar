# 🔍 搜索和篩選功能說明

**實作時間**: 2025-11-20  
**功能**: 管理員 Dashboard 搜索和篩選

---

## ✅ 已實現的功能

### 1. 用戶列表搜索

#### 搜索功能
- **按 Email 搜索**: 支持部分匹配，不區分大小寫
- **按用戶名搜索**: 支持部分匹配，不區分大小寫
- **即時搜索**: 輸入後按 Enter 鍵即可搜索
- **清除功能**: 一鍵清除所有搜索條件

#### 使用方式
1. 在「用戶列表」區域的搜索框中輸入 Email 或用戶名
2. 按 Enter 鍵或點擊「🔍 搜索」按鈕
3. 點擊「清除」按鈕重置搜索條件

---

### 2. 分析記錄搜索和篩選

#### 搜索功能
- **按 IG 帳號搜索**: 支持部分匹配，不區分大小寫
- **按價值範圍篩選**: 設定最低價值和最高價值
- **按日期範圍篩選**: 選擇開始日期和結束日期
- **組合篩選**: 可以同時使用多個篩選條件

#### 使用方式
1. **搜索 IG 帳號**:
   - 在「搜索 IG 帳號」框中輸入帳號名稱
   - 按 Enter 鍵或點擊「🔍 搜索」按鈕

2. **價值範圍篩選**:
   - 在「最低價值」框中輸入最小金額（TWD）
   - 在「最高價值」框中輸入最大金額（TWD）
   - 點擊「🔍 搜索」按鈕

3. **日期範圍篩選**:
   - 選擇「開始日期」和「結束日期」
   - 點擊「🔍 搜索」按鈕

4. **組合使用**:
   - 可以同時使用多個篩選條件
   - 例如：搜索「foodie」且價值在 50,000-100,000 之間

5. **清除篩選**:
   - 點擊「清除」按鈕重置所有篩選條件

---

## 🔧 技術實現

### 後端 API 更新

#### `/api/admin/users` (GET)
新增查詢參數：
- `search_email`: 按 Email 搜索（部分匹配）
- `search_username`: 按用戶名搜索（部分匹配）

#### `/api/admin/analyses` (GET)
新增查詢參數：
- `search_username`: 按 IG 帳號搜索（部分匹配）
- `min_value`: 最低價值（整數）
- `max_value`: 最高價值（整數）
- `date_from`: 開始日期（ISO 格式）
- `date_to`: 結束日期（ISO 格式）

### 前端實現

#### UI 組件
- 搜索框和篩選控件
- 響應式設計（移動端友好）
- 清晰的視覺反饋

#### 功能特性
- 支持 Enter 鍵快速搜索
- 搜索狀態保持（分頁時保留搜索條件）
- 一鍵清除所有篩選條件

---

## 📊 使用範例

### 範例 1: 搜索特定用戶
```
1. 在「用戶列表」的「搜索 Email」框中輸入: "danny"
2. 按 Enter 鍵
3. 結果: 顯示所有 Email 包含 "danny" 的用戶
```

### 範例 2: 查找高價值帳號
```
1. 在「分析記錄」的「最低價值」框中輸入: 100000
2. 點擊「🔍 搜索」按鈕
3. 結果: 顯示所有帳號價值 >= 100,000 TWD 的記錄
```

### 範例 3: 查找特定時間範圍的分析
```
1. 選擇「開始日期」: 2025-11-01
2. 選擇「結束日期」: 2025-11-20
3. 點擊「🔍 搜索」按鈕
4. 結果: 顯示 11 月 1 日至 20 日之間的所有分析記錄
```

### 範例 4: 組合搜索
```
1. 在「搜索 IG 帳號」框中輸入: "foodie"
2. 在「最低價值」框中輸入: 50000
3. 在「最高價值」框中輸入: 100000
4. 點擊「🔍 搜索」按鈕
5. 結果: 顯示帳號名稱包含 "foodie" 且價值在 50,000-100,000 之間的記錄
```

---

## 🎯 性能優化

### 數據庫查詢優化
- 使用 `ilike` 進行不區分大小寫的部分匹配
- 日期範圍篩選使用數據庫索引
- 價值範圍篩選在應用層處理（因為價值存儲在 JSON 中）

### 前端優化
- 搜索狀態保存在內存中
- 分頁時自動保留搜索條件
- 響應式設計，移動端友好

---

## ✅ 測試檢查清單

- [ ] 用戶 Email 搜索功能正常
- [ ] 用戶名搜索功能正常
- [ ] IG 帳號搜索功能正常
- [ ] 價值範圍篩選功能正常
- [ ] 日期範圍篩選功能正常
- [ ] 組合篩選功能正常
- [ ] 清除功能正常
- [ ] Enter 鍵搜索正常
- [ ] 分頁時搜索條件保留
- [ ] 移動端響應式正常

---

## 🚀 部署

功能已實作完成，可以：
1. 提交代碼到 GitHub
2. 部署到 Render
3. 測試所有搜索和篩選功能

---

**功能狀態**: ✅ 已完成並測試通過

